<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Tony's SkyView Portfolio - 16:9 Videos</title>

<!-- [중요] Tailwind CSS 최신 버전 (슬라이더 호환용) -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Google Fonts (Inter & Pretendard) -->
<link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">

<!-- Preload banner images (Performance Optimization) -->
<link rel="preload" as="image" href="./images/songak.png">
<link rel="preload" as="image" href="./images/sanbang.png">
<link rel="preload" as="image" href="./images/sanbangsan.jpg">
<link rel="preload" as="image" href="./images/baksu.png">
<link rel="preload" as="image" href="./images/tiger.png">
<link rel="preload" as="image" href="./images/sup.png">

<script>
  tailwind.config = {
    theme: {
      extend: {
        colors: {
          brand: {
            dark: '#1f3556',
            DEFAULT: '#2b5aa6',
            hover: '#234b8b',
          },
          accent: '#7b1fa2',
          page: '#f2f2f2',
          card: '#ffffff',
          primary: "#16A34A",
          ink: "#1F2933",
          warm: "#FFFBEA",
        },
        fontFamily: {
          sans: ['Pretendard', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'sans-serif'],
        }
      }
    }
  }
</script>

<style>
  /* * Design System Variables */
  :root{ 
    --brand-dark:#1f3556; 
    --brand:#2b5aa6; 
    --brand-hover:#234b8b; 
    --accent:#7b1fa2;
    --card-bg:#ffffff; 
    --page-bg:#f2f2f2; 
    --text:#111827; 
    --muted:#6b7280; 
  }
  
  /* Dark Mode Support */
  @media (prefers-color-scheme: dark){
    :root{ 
      --card-bg:#111827; 
      --page-bg:#0b1220; 
      --text:#e5e7eb; 
      --muted:#9ca3af;
      --brand-dark:#162640; 
      --brand:#2b5aa6; 
      --brand-hover:#234b8b; 
      --accent:#8b5cf6; 
    }
    body { background-color: #0b1220; color: #e5e7eb; }
  }

  body{ font-family:'Pretendard', sans-serif; background:var(--page-bg); color:var(--text); line-height: 1.6; word-break: keep-all; }
  
  /* [Slider Styles] 배너 슬라이드 전용 */
  .slider-transition { transition: transform 1s ease-in-out; }
  .text-shadow { text-shadow: 2px 2px 4px rgba(0,0,0,.55); }
  
  /* [Navigation] 스타일 */
  .navbar{ background:var(--brand-dark); }
  .nav-btn{
    background:var(--brand); 
    color:#fff; 
    border:none; 
    padding:10px 20px; 
    margin:0 5px; 
    border-radius:8px;
    text-decoration:none; 
    font-size:14px; 
    transition:background .25s ease;
    min-width:110px;
    text-align:center;
    display:inline-block;
  }
  .nav-btn:hover{ background:var(--brand-hover); }
  
  /* Intro Banner */
  .intro{
    background: linear-gradient(90deg, var(--brand), var(--accent));
    color: #ffffff;
    font-size: 1.25rem;
    font-weight: 700;
    line-height: 1.8;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.18);
    text-align: center;
    max-width: 70%;
    margin: 2rem auto;
    border: 0;
  }
  
  .video-section-title{ color:var(--brand-dark); font-size:2rem; font-weight:800; margin-bottom:1rem; }
  @media (prefers-color-scheme:dark){ .video-section-title{ color:#cbd5e1; } }
  
  /* Grid Layout for Video Cards */
  .grid-layout{ display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:28px; padding:16px; justify-items:center; }
  
  /* Card Component */
  .video-card{ width:100%; max-width:320px; background:var(--card-bg); border-radius:14px; overflow:hidden; box-shadow:0 6px 18px rgba(0,0,0,.08); transition:transform .25s ease, box-shadow .25s ease; }
  @media (prefers-color-scheme: dark) { .video-card { background-color: #111827; } }
  .video-card:hover{ transform:translateY(-6px); box-shadow:0 10px 24px rgba(0,0,0,.15);}
  
  .thumb{ position:relative; aspect-ratio:16/9; background:#000; display:block; cursor: pointer; }
  .thumb img{ width:100%; height:100%; object-fit:cover; display:block;}
  .play{ position:absolute; right:12px; bottom:12px; background:rgba(0,0,0,.6); color:#fff; font-size:12px; padding:6px 10px; border-radius:999px;}
  
  .yt{ text-align:center; padding:10px 12px 14px;}
  .yt a{ color:var(--accent); font-size:.9rem; text-decoration:none;}
  @media (prefers-color-scheme: dark) { .yt a { color: #8b5cf6; } }
  .yt a:hover{ text-decoration:underline; }

  /* Contact Modal */
  .modal{ position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; z-index:1000; }
  .modal-content{ background:var(--card-bg); color:var(--text); padding:2rem; border-radius:.75rem; width:min(92vw,420px); text-align:center; box-shadow:0 10px 30px rgba(0,0,0,.35); }
  @media (prefers-color-scheme: dark) { .modal-content { background-color: #111827; } }
  .btn{ background:var(--brand); color:#fff; padding:.6rem 1rem; border-radius:.6rem; }
  .btn:hover{ background:var(--brand-hover); }

  /* Lightbox */
  .lightbox{ position:fixed; inset:0; background:rgba(0,0,0,.85); display:none; align-items:center; justify-content:center; z-index:1100; padding:24px; }
  .lightbox-inner{ width:min(96vw,1100px); }
  .lb-close{ position:absolute; top:16px; right:16px; background:rgba(255,255,255,.15); color:#fff; padding:8px 12px; border-radius:8px; cursor:pointer; }
  
  /* Mobile Responsiveness */
  @media (max-width:768px){
    .intro{ width:90%; padding:16px;}
    .navbar{ flex-wrap:wrap; padding:10px;}
    .nav-btn{ margin:5px; padding:8px 12px;}
    .header-title { font-size: 2.5rem !important; }
  }
</style>
</head>
<body>
  
  <!-- 
    [HERO / Banner Slider] 
    videos.html에도 동일하게 적용된 롤링 배너
  -->
  <header class="relative w-full h-[320px] md:h-[480px] overflow-hidden bg-gray-900">
    <div id="slider-track"
         class="absolute inset-y-0 left-0 flex h-full slider-transition">
      <!-- Images injected via JS below -->
    </div>

    <!-- overlay -->
    <div class="absolute inset-0 bg-sky-900/20"></div>

    <!-- Title -->
    <h1 class="header-title absolute left-1/2 -translate-x-1/2 top-[50%] -translate-y-[50%]
               text-5xl md:text-7xl font-extrabold text-white text-shadow tracking-tight z-20 w-full text-center px-4">
      Tony's Sky View
    </h1>
  </header>

  <!-- Navigation Bar -->
  <div class="navbar flex justify-center py-2 shadow-md">
    <a href="index.html" class="nav-btn">Home</a>
    <a href="videos.html" class="nav-btn">Videos</a>
    <a href="shorts.html" class="nav-btn">Shorts</a>
    <a href="https://smile21c.notion.site/my-profile" class="nav-btn" target="_blank" rel="noopener">About Me</a>
    <a href="#" class="nav-btn" id="contact-btn">Contact Me</a>
  </div>

  <!-- Motto/Intro -->
  <div class="intro mx-auto my-8 p-6 rounded-xl shadow-lg w-3/5 text-center">
      행복은 삶의 질을 좋게 하는 수단이지 결코 그 자체가 목적이 되어서는 안 된다.
  </div>

  <hr class="border-t-2 border-gray-300 my-8 w-4/5 mx-auto">

  <!-- Main Video Grid -->
  <div id="videos" class="text-center py-6">
    <h2 class="video-section-title">16:9 Videos</h2>
    <!-- Loading State -->
    <div id="loading" class="text-gray-500 mb-4 font-bold max-w-2xl mx-auto px-4">Loading videos...</div>
    <div id="videos-container" class="grid-layout"></div>
  </div>

  <!-- Contact Modal -->
  <div id="contact-modal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <h3 class="text-xl font-bold mb-4">Contact Information</h3>
      <p class="text-gray-700 mb-6" style="color:var(--muted)">Email: smile21c@korea.com</p>
      <button id="close-modal-btn" class="btn">Close</button>
    </div>
  </div>

  <!-- Lightbox Player -->
  <div id="lightbox" class="lightbox" aria-hidden="true">
    <div class="lightbox-inner">
      <button class="lb-close" id="lb-close" aria-label="Close video">Close ✕</button>
      <div id="lb-target"></div>
    </div>
  </div>

<script>
  /**
   * [설정 1] Google Apps Script 배포 URL
   */
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxdmO5YEMjTvrArVSmqyN0em4IQOzhOSfjf3mWBqlxA_qlht4Hf0udgJJA5uVQrsmmTPQ/exec"; 

  /**
   * [설정 2] Banner Images
   */
  const BANNER_IMAGES = [
    "./images/songak.png",
    "./images/sanbang.png",
    "./images/sanbangsan.jpg",
    "./images/baksu.png",
    "./images/tiger.png",
    "./images/sup.png"
  ];
  
  /**
   * Banner Slider Logic
   */
  document.addEventListener('DOMContentLoaded', () => {
    const track = document.getElementById('slider-track');
    if (!track) return;

    const imagesToUse = (BANNER_IMAGES && BANNER_IMAGES.length > 0) ? BANNER_IMAGES : [];
    if (imagesToUse.length === 0) return;

    const imagesToRender = [...imagesToUse, imagesToUse[0]];
    const totalSlides = imagesToUse.length;
    const slidesWithClone = imagesToRender.length;
    const slideWidthPercent = 100 / slidesWithClone;

    track.innerHTML = imagesToRender.map((src, i) => `
      <img src="${src}" 
           class="h-full object-cover flex-shrink-0" 
           alt="Banner ${i}" 
           style="width: ${slideWidthPercent}%;"
           onerror="this.onerror=null; this.src='https://placehold.co/1920x1080/CCCCCC/666666?text=Image+Loading...';"> 
    `).join('');

    track.style.width = `${slidesWithClone * 100}%`;
    
    const durationMs = 1000; 
    const intervalMs = 10000; // 10 seconds
    let index = 0;
    let timer = null;

    function goTo(i, withTransition = true) {
      track.style.transition = withTransition ? `transform ${durationMs}ms ease-in-out` : 'none';
      track.style.transform = `translateX(-${i * slideWidthPercent}%)`;
    }

    function scheduleNext() {
      clearTimeout(timer);
      timer = setTimeout(nextSlide, intervalMs);
    }

    function nextSlide() {
      index += 1;
      goTo(index, true);

      if (index === totalSlides) {
        const onEnd = (e) => {
          if (e.propertyName !== 'transform') return;
          track.removeEventListener('transitionend', onEnd);
          index = 0;
          goTo(index, false);
          requestAnimationFrame(() => {
            requestAnimationFrame(() => {
              track.style.transition = `transform ${durationMs}ms ease-in-out`;
            });
          });
          scheduleNext();
        };
        track.addEventListener('transitionend', onEnd);
      } else {
        scheduleNext();
      }
    }

    goTo(0, false);
    scheduleNext();

    document.addEventListener('visibilitychange', () => {
      if (document.hidden) clearTimeout(timer);
      else scheduleNext();
    });
  });

  /**
   * YouTube ID Extraction Logic
   */
  function getId(url){
    if(!url) return null;
    try{
      const u = new URL(url);
      const v = u.searchParams.get('v');
      if (v && v.length === 11) return v;
      const parts = u.pathname.split('/');
      for (let i = parts.length - 1; i >= 0; i--) {
        const seg = parts[i];
        if (seg && seg.length === 11) return seg;
      }
    }catch(e){
      const m = url.match(/(?:watch\?v=|youtu\.be\/|embed\/|v\/)([A-Za-z0-9_-]{11})/);
      if (m) return m[1];
    }
    return null;
  }

  // Lightbox DOM Elements
  const lb = document.getElementById('lightbox');
  const lbClose = document.getElementById('lb-close');
  const lbTarget = document.getElementById('lb-target');

  function openLB(id){
    lbTarget.innerHTML = `<iframe title="YouTube video player" style="width:100%;aspect-ratio:16/9;border:0;border-radius:12px;" src="https://www.youtube.com/embed/${id}?autoplay=1&mute=1&playsinline=1" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
    lb.style.display='flex'; 
    lb.setAttribute('aria-hidden','false');
  }

  function closeLB(){ 
    lb.style.display='none'; 
    lb.setAttribute('aria-hidden','true'); 
    lbTarget.innerHTML=''; 
  }

  lbClose.addEventListener('click', closeLB);
  lb.addEventListener('click', e=>{ if(e.target===lb) closeLB(); });
  window.addEventListener('keydown', e=>{ if(e.key==='Escape') closeLB(); });

  /**
   * Render List Logic
   */
  function render(list, containerId){
    const el=document.getElementById(containerId); 
    const loadingEl = document.getElementById('loading');
    
    if(!el) return;
    
    // Clear loading message
    if(loadingEl) loadingEl.style.display = 'none';
    el.innerHTML = ''; 

    // Sort by date descending
    list.sort((a,b)=> new Date(b.date)-new Date(a.date));
    
    list.forEach(v=>{
      const id=getId(v.url); 
      if(!id) return; 
      
      const card=document.createElement('div'); 
      card.className='video-card'; 
      card.setAttribute('role','button'); 
      card.tabIndex=0;
      
      card.innerHTML=`
        <a class="thumb"><img loading="lazy" src="https://img.youtube.com/vi/${id}/hqdefault.jpg" alt="${v.title} 썸네일"><span class="play">Play</span></a>
        <div class="yt"><a href="${v.url}" target="_blank" rel="noopener">[유튜브 바로가기]</a></div>
      `;
      
      const act=(e)=>{ 
        const isYt = e.target.closest('.yt'); 
        if(!isYt){ openLB(id); } 
      };
      card.addEventListener('click', act);
      card.addEventListener('keydown', e=>{ 
        if(e.key==='Enter'||e.key===' '){ 
          e.preventDefault(); 
          openLB(id); 
        }
      });
      el.appendChild(card);
    });
  }

  /**
   * Fetch Data from Google Spreadsheet
   */
  async function loadVideos() {
    const loadingEl = document.getElementById('loading');
    try {
      const response = await fetch(SCRIPT_URL, {
        method: 'GET',
        redirect: 'follow'
      });
      
      if (!response.ok) {
        throw new Error(`HTTP Error Status: ${response.status}`);
      }

      const text = await response.text();
      let data;
      
      try {
        data = JSON.parse(text);
      } catch (e) {
        const previewText = text.length > 400 ? text.substring(0, 400) + "..." : text;
        throw new Error(`서버가 JSON 데이터 대신 다른 메시지를 보냈습니다.\n\n[서버 응답 내용]:\n${previewText.replace(/</g, '&lt;')}`);
      }
      
      if(!data || !Array.isArray(data) || data.length === 0) {
        if(loadingEl) loadingEl.textContent = '데이터가 비어있습니다. (Empty Array Returned)';
        return;
      }

      render(data, 'videos-container');
      
    } catch (error) {
      console.error('Fetch error:', error);
      if(loadingEl) {
        loadingEl.innerHTML = `
          <div style="color:#991b1b; background:#fee2e2; padding:20px; border-radius:12px; text-align:left; border:2px solid #f87171; font-family: monospace; white-space: pre-wrap; overflow-x: auto;">
            <h3 style="font-weight:bold; font-size:1.2rem; margin-bottom:10px;">⚠️ 진단 결과 (Diagnostic Result)</h3>
            <p style="margin-bottom:10px;"><strong>오류 메시지:</strong> ${error.message}</p>
          </div>
        `;
      }
    }
  }

  // Execution
  loadVideos();

  // Modal Interaction Logic
  const contactBtn=document.getElementById('contact-btn');
  const contactModal=document.getElementById('contact-modal');
  const closeModalBtn=document.getElementById('close-modal-btn');
  
  if(contactBtn && contactModal && closeModalBtn){
    contactBtn.addEventListener('click',e=>{ 
      e.preventDefault(); 
      contactModal.style.display='flex'; 
      contactModal.setAttribute('aria-hidden','false');
    });
    closeModalBtn.addEventListener('click',()=>{ 
      contactModal.style.display='none'; 
      contactModal.setAttribute('aria-hidden','true');
    });
    contactModal.addEventListener('click',e=>{ 
      if(e.target===contactModal){ 
        contactModal.style.display='none'; 
        contactModal.setAttribute('aria-hidden','true');
      }
    });
  }

  // Helper: Open External Links
  document.addEventListener('click', (e)=>{
    const link = e.target.closest('.yt a');
    if(!link) return;
    e.preventDefault();
    const url = link.href;
    const w = window.screen.width, h = window.screen.height;
    const win = window.open(url, '_blank', `scrollbars=yes,width=${w},height=${h},top=0,left=0`);
    if(win && win.focus) win.focus();
  });
</script>
</body>

</html>

