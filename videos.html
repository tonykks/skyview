<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Tony's SkyView Portfolio - 16:9 Videos</title>
<!-- Tailwind CSS (Utility Framework) -->
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<!-- Google Fonts (Inter) -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
<style>
  /* * Design System Variables */
  :root{ 
    --brand-dark:#1f3556; 
    --brand:#2b5aa6; 
    --brand-hover:#234b8b; 
    --accent:#7b1fa2;
    --card-bg:#ffffff; 
    --page-bg:#f2f2f2; 
    --text:#111827; 
    --muted:#6b7280; 
  }
  
  /* Dark Mode Support */
  @media (prefers-color-scheme: dark){
    :root{ 
      --card-bg:#111827; 
      --page-bg:#0b1220; 
      --text:#e5e7eb; 
      --muted:#9ca3af;
      --brand-dark:#162640; 
      --brand:#2b5aa6; 
      --brand-hover:#234b8b; 
      --accent:#8b5cf6; 
    }
  }

  body{ font-family:'Inter',sans-serif; background:var(--page-bg); color:var(--text); }
  
  /* Header Section */
  .header{
    background-image:url('https://yt3.googleusercontent.com/JHTHRsm3_keOY7f6dLzgDkG7e_olnUvd9Nd0hNfcCbGDScdnOyKDFmuaARWFX05zWaPjwjsAJw=w1707-fcrop64=1,00005a57ffffa5a8-k-c0xffffffff-no-nd-rj');
    background-size:cover;
    background-position:center;
    height:250px;
    color:#fff;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:48px;
    font-weight:900;
    text-align:center;
    text-shadow: 2px 2px 6px rgba(0,0,0,0.7);
  }
  
  /* Navigation */
  .navbar{ background:var(--brand-dark); }
  .nav-btn{
    background:var(--brand); 
    color:#fff; 
    border:none; 
    padding:10px 20px; 
    margin:0 5px; 
    border-radius:8px;
    text-decoration:none; 
    font-size:14px; 
    transition:background .25s ease;
    min-width:110px;
    text-align:center;
    display:inline-block;
  }
  .nav-btn:hover{ background:var(--brand-hover); }
  
  /* Intro Banner */
  .intro{
    background: linear-gradient(90deg, var(--brand), var(--accent));
    color: #ffffff;
    font-size: 1.25rem;
    font-weight: 700;
    line-height: 1.8;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.18);
    text-align: center;
    max-width: 70%;
    margin: 2rem auto;
    border: 0;
  }
  
  .video-section-title{ color:var(--brand-dark); font-size:2rem; font-weight:800; margin-bottom:1rem; }
  @media (prefers-color-scheme:dark){ .video-section-title{ color:#cbd5e1; } }
  
  /* Grid Layout for Video Cards */
  .grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:28px; padding:16px; justify-items:center; }
  
  /* Card Component */
  .card{ width:100%; max-width:320px; background:var(--card-bg); border-radius:14px; overflow:hidden; box-shadow:0 6px 18px rgba(0,0,0,.08); transition:transform .25s ease, box-shadow .25s ease; }
  .card:hover{ transform:translateY(-6px); box-shadow:0 10px 24px rgba(0,0,0,.15);}
  
  .thumb{ position:relative; aspect-ratio:16/9; background:#000; display:block; cursor: pointer; }
  .thumb img{ width:100%; height:100%; object-fit:cover; display:block;}
  .play{ position:absolute; right:12px; bottom:12px; background:rgba(0,0,0,.6); color:#fff; font-size:12px; padding:6px 10px; border-radius:999px;}
  
  .yt{ text-align:center; padding:10px 12px 14px;}
  .yt a{ color:var(--accent); font-size:.9rem; text-decoration:none;}
  .yt a:hover{ text-decoration:underline; }

  /* Contact Modal */
  .modal{ position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; z-index:1000; }
  .modal-content{ background:var(--card-bg); color:var(--text); padding:2rem; border-radius:.75rem; width:min(92vw,420px); text-align:center; box-shadow:0 10px 30px rgba(0,0,0,.35); }
  .btn{ background:var(--brand); color:#fff; padding:.6rem 1rem; border-radius:.6rem; }
  .btn:hover{ background:var(--brand-hover); }

  /* Lightbox */
  .lightbox{ position:fixed; inset:0; background:rgba(0,0,0,.85); display:none; align-items:center; justify-content:center; z-index:1100; padding:24px; }
  .lightbox-inner{ width:min(96vw,1100px); }
  .lb-close{ position:absolute; top:16px; right:16px; background:rgba(255,255,255,.15); color:#fff; padding:8px 12px; border-radius:8px; cursor:pointer; }
  
  /* Mobile Responsiveness */
  @media (max-width:768px){
    .header{ font-size:28px; height:200px;}
    .intro{ width:90%; padding:16px;}
    .navbar{ flex-wrap:wrap; padding:10px;}
    .nav-btn{ margin:5px; padding:8px 12px;}
  }
</style>
</head>
<body>
  <div class="header">Tony's SkyView Portfolio</div>

  <!-- Navigation Bar -->
  <div class="navbar flex justify-center py-2 shadow-md">
    <a href="index.html" class="nav-btn">Home</a>
    <a href="videos.html" class="nav-btn">Videos</a>
    <a href="shorts.html" class="nav-btn">Shorts</a>
    <a href="word_card.html" class="nav-btn">English</a>
    <a href="https://smile21c.notion.site/my-profile" class="nav-btn" target="_blank" rel="noopener">About Me</a>
    <a href="#" class="nav-btn" id="contact-btn">Contact Me</a>
  </div>

  <!-- Motto/Intro -->
  <div class="intro mx-auto my-8 p-6 rounded-xl shadow-lg w-3/5 text-center">
      행복은 삶의 질을 좋게 하는 수단이지 결코 그 자체가 목적이 되어서는 안 된다.
  </div>

  <hr class="border-t-2 border-gray-300 my-8 w-4/5 mx-auto">

  <!-- Main Video Grid -->
  <div id="videos" class="text-center py-6">
    <h2 class="video-section-title">16:9 Videos</h2>
    <!-- Loading State with more space for debug info -->
    <div id="loading" class="text-gray-500 mb-4 font-bold max-w-2xl mx-auto px-4">Loading videos...</div>
    <div id="videos-container" class="grid"></div>
  </div>

  <!-- Contact Modal -->
  <div id="contact-modal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <h3 class="text-xl font-bold mb-4">Contact Information</h3>
      <p class="text-gray-700 mb-6" style="color:var(--muted)">Email: smile21c@korea.com</p>
      <button id="close-modal-btn" class="btn">Close</button>
    </div>
  </div>

  <!-- Lightbox Player -->
  <div id="lightbox" class="lightbox" aria-hidden="true">
    <div class="lightbox-inner">
      <button class="lb-close" id="lb-close" aria-label="Close video">Close ✕</button>
      <div id="lb-target"></div>
    </div>
  </div>

<script>
  /**
   * [설정] Google Apps Script 배포 URL
   * 주인님께서 제공하신 URL을 사용합니다.
   */
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxdmO5YEMjTvrArVSmqyN0em4IQOzhOSfjf3mWBqlxA_qlht4Hf0udgJJA5uVQrsmmTPQ/exec"; 

  /**
   * YouTube ID Extraction Logic
   */
  function getId(url){
    if(!url) return null;
    try{
      const u = new URL(url);
      const v = u.searchParams.get('v');
      if (v && v.length === 11) return v;
      const parts = u.pathname.split('/');
      for (let i = parts.length - 1; i >= 0; i--) {
        const seg = parts[i];
        if (seg && seg.length === 11) return seg;
      }
    }catch(e){
      const m = url.match(/(?:watch\?v=|youtu\.be\/|embed\/|v\/)([A-Za-z0-9_-]{11})/);
      if (m) return m[1];
    }
    return null;
  }

  // Lightbox DOM Elements
  const lb = document.getElementById('lightbox');
  const lbClose = document.getElementById('lb-close');
  const lbTarget = document.getElementById('lb-target');

  function openLB(id){
    lbTarget.innerHTML = `<iframe title="YouTube video player" style="width:100%;aspect-ratio:16/9;border:0;border-radius:12px;" src="https://www.youtube.com/embed/${id}?autoplay=1&mute=1&playsinline=1" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
    lb.style.display='flex'; 
    lb.setAttribute('aria-hidden','false');
  }

  function closeLB(){ 
    lb.style.display='none'; 
    lb.setAttribute('aria-hidden','true'); 
    lbTarget.innerHTML=''; 
  }

  lbClose.addEventListener('click', closeLB);
  lb.addEventListener('click', e=>{ if(e.target===lb) closeLB(); });
  window.addEventListener('keydown', e=>{ if(e.key==='Escape') closeLB(); });

  /**
   * Render List Logic
   */
  function render(list, containerId){
    const el=document.getElementById(containerId); 
    const loadingEl = document.getElementById('loading');
    
    if(!el) return;
    
    // Clear loading message
    if(loadingEl) loadingEl.style.display = 'none';
    el.innerHTML = ''; 

    // Sort by date descending
    list.sort((a,b)=> new Date(b.date)-new Date(a.date));
    
    list.forEach(v=>{
      const id=getId(v.url); 
      if(!id) return; 
      
      const card=document.createElement('div'); 
      card.className='card'; 
      card.setAttribute('role','button'); 
      card.tabIndex=0;
      
      card.innerHTML=`
        <a class="thumb"><img loading="lazy" src="https://img.youtube.com/vi/${id}/hqdefault.jpg" alt="${v.title} 썸네일"><span class="play">Play</span></a>
        <div class="yt"><a href="${v.url}" target="_blank" rel="noopener">[유튜브 바로가기]</a></div>
      `;
      
      const act=(e)=>{ 
        const isYt = e.target.closest('.yt'); 
        if(!isYt){ openLB(id); } 
      };
      card.addEventListener('click', act);
      card.addEventListener('keydown', e=>{ 
        if(e.key==='Enter'||e.key===' '){ 
          e.preventDefault(); 
          openLB(id); 
        }
      });
      el.appendChild(card);
    });
  }

  /**
   * Fetch Data from Google Spreadsheet (Modified for Robust Error Handling)
   * 변경점: JSON 파싱 실패 시 서버가 보낸 원본 텍스트(HTML 에러 등)를 보여줌
   */
  async function loadVideos() {
    const loadingEl = document.getElementById('loading');
    try {
      const response = await fetch(SCRIPT_URL);
      
      // 1. HTTP 상태 코드 확인
      if (!response.ok) {
        throw new Error(`HTTP Error: ${response.status}`);
      }

      // 2. 텍스트로 먼저 받기 (JSON 파싱 에러를 잡기 위해)
      const text = await response.text();
      let data;
      
      try {
        data = JSON.parse(text);
      } catch (e) {
        // 3. JSON 파싱 실패 시 = 서버 스크립트 에러 (HTML 리턴됨)
        // 에러 내용의 앞부분만 잘라서 보여줌
        const errorSnippet = text.length > 200 ? text.substring(0, 200) + "..." : text;
        throw new Error(`서버 응답이 JSON이 아닙니다 (스크립트 에러 가능성): ${errorSnippet.replace(/</g, '&lt;')}`);
      }
      
      if(!data || data.length === 0) {
        if(loadingEl) loadingEl.textContent = '데이터가 비어있습니다. 스프레드시트의 "landscape" 시트에 데이터가 있는지 확인해주세요.';
        return;
      }

      render(data, 'videos-container');
      
    } catch (error) {
      console.error('Fetch error:', error);
      if(loadingEl) {
        // 4. 사용자에게 구체적인 진단 가이드 표시
        loadingEl.innerHTML = `
          <div style="color:#b91c1c; background:#fef2f2; padding:16px; border-radius:8px; text-align:left; font-size:14px; border:1px solid #fecaca;">
            <strong style="font-size:16px;">⚠️ 데이터 로드 실패</strong><br/><br/>
            <strong>오류 내용:</strong> <span style="font-family:monospace; background:#fff; padding:2px 4px; border-radius:4px;">${error.message}</span><br/><br/>
            <strong>[해결 체크리스트]</strong>
            <ul style="list-style-type:disc; margin-left:20px; margin-top:8px; line-height:1.6;">
              <li><strong>1순위:</strong> 스프레드시트 하단의 시트(탭) 이름이 정확히 <code style="background:#e5e7eb; padding:2px 4px; border-radius:4px;">landscape</code> (모두 소문자)인지 확인하세요. (예: "Landscape", "Sheet1" 불가)</li>
              <li><strong>2순위:</strong> 데이터가 A2행부터 시작하는지 확인하세요. (1행은 제목)</li>
              <li><strong>3순위:</strong> Apps Script에서 수정 후 <strong>[배포] > [새 버전]</strong>으로 다시 배포했는지 확인하세요.</li>
            </ul>
          </div>
        `;
      }
    }
  }

  // Execution
  loadVideos();

  // Modal Interaction Logic
  const contactBtn=document.getElementById('contact-btn');
  const contactModal=document.getElementById('contact-modal');
  const closeModalBtn=document.getElementById('close-modal-btn');
  
  if(contactBtn && contactModal && closeModalBtn){
    contactBtn.addEventListener('click',e=>{ 
      e.preventDefault(); 
      contactModal.style.display='flex'; 
      contactModal.setAttribute('aria-hidden','false');
    });
    closeModalBtn.addEventListener('click',()=>{ 
      contactModal.style.display='none'; 
      contactModal.setAttribute('aria-hidden','true');
    });
    contactModal.addEventListener('click',e=>{ 
      if(e.target===contactModal){ 
        contactModal.style.display='none'; 
        contactModal.setAttribute('aria-hidden','true');
      }
    });
  }

  // Helper: Open External Links
  document.addEventListener('click', (e)=>{
    const link = e.target.closest('.yt a');
    if(!link) return;
    e.preventDefault();
    const url = link.href;
    const w = window.screen.width, h = window.screen.height;
    const win = window.open(url, '_blank', `scrollbars=yes,width=${w},height=${h},top=0,left=0`);
    if(win && win.focus) win.focus();
  });
</script>
</body>
</html>
